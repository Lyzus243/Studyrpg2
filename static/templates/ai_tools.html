<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Study Tools - StudyRPG</title>
  <style>
 #studyMaterial {
    color: white;
}

#flashcardTopic {
    color: white;
}   
    
    :root {
      --primary: #4facfe;
      --secondary: #00f2fe;
      --text-light: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.8);
      --card-bg: rgba(255, 255, 255, 0.07);
      --card-border: rgba(255, 255, 255, 0.15);
      --input-bg: rgba(255, 255, 255, 0.1);
      --input-border: rgba(255, 255, 255, 0.2);
      --button-bg: rgba(255, 255, 255, 0.2);
      --button-hover: rgba(255, 255, 255, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(
    135deg,
    #1a1a2e 0%,       /* Deep night (mystery/quests) */
    #1e3c72 25%,      /* Steel blue (survival/cold tech) */
    #e52d27 60%,      /* Blood red (danger/battle) */
    #ffb347 85%,      /* Ember glow (energy/climax) */
    #6df0ff 100%      /* Cyber neon (tech/futurism) */
);
background-size: 400% 400%;
animation: gradientPulse 15s ease infinite;
      color: var(--text-light);
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .header p {
      color: var(--text-muted);
    }

    .section {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 15px;
      padding: 2rem;
      backdrop-filter: blur(10px);
      margin-bottom: 2rem;
    }

    .section h2 {
      font-size: 1.75rem;
      margin-bottom: 1rem;
    }

    .section p {
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .upload-area {
      border: 2px dashed var(--secondary);
      border-radius: 10px;
      padding: 2rem;
      text-align: center;
      background: var(--input-bg);
      cursor: pointer;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-light);
    }

    .btn {
      background: var(--button-bg);
      color: var(--text-light);
      font-weight: bold;
      border: 1px solid var(--button-hover);
      transition: background 0.3s;
    }

    .btn:hover {
      background: var(--button-hover);
    }

    .back-link {
      display: block;
      margin-bottom: 2rem;
      color: var(--text-light);
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/dashboard" class="back-link">‚Üê Back to Dashboard</a>
    <div class="header">
      <h1>AI Study Tools</h1>
      <p>Transform your study materials with AI-powered tools</p>
    </div>

    <!-- PDF Upload Section -->
    <form class="section" id="pdfForm">
      <h2>üìÑ PDF Analysis</h2>
      <p>Upload PDF files to extract key information and generate study materials.</p>
      <div class="upload-area" id="uploadArea">
        <p>Click or drag PDF file here</p>
        <input type="file" id="pdfFile" accept="application/pdf" style="display: none;">
      </div>
      <div class="file-info hidden" id="fileInfo">
        <strong>Selected file:</strong> <span id="fileName"></span>
      </div>
      <div class="spinner hidden" id="processing"></div>
      <div class="success hidden" id="result">PDF processed successfully!</div>
      <button type="submit" class="btn">Process PDF</button>
    </form>

    <!-- Manual Flashcard Section -->
    <form class="section" id="manualFlashcardForm">
      <h2>üé¥ Manual Flashcard Creation</h2>
      <p>Create flashcards manually by entering your study material and topics.</p>
      <textarea id="studyMaterial"  placeholder="Enter your study material..."></textarea>
      <input type="text" id="flashcardTopic" placeholder="Topic/Subject">
      <select id="numCards">
        <option value="5" style="color: black;">5 cards</option>
        <option value="10" selected style="color: black;">10 cards</option>
        <option value="15" style="color: black;">15 cards</option>
        <option value="20" style="color: black;">20 cards</option>
      </select>
      <button type="submit" class="btn">Generate Flashcards</button>
    </form>

    <!-- AI Study Assistant Section -->
    <div class="section">
      <h2>ü§ñ AI Study Assistant</h2>
      <p>Get personalized study recommendations and practice tests.</p>
      <select id="studyGoal">
        <option value="exam_prep" style="color: black;">Exam Preparation</option>
        <option value="concept_review" style="color: black;">Concept Review</option>
        <option value="skill_building" style="color: black;">Skill Building</option>
        <option value="quick_review" style="color: black;">Quick Review</option>
      </select>
      <button class="btn" onclick="generatePracticeTest()">Generate Practice Test</button>
      <button class="btn" onclick="getRecommendations()">Get Recommendations</button>
    </div>

    <!-- Memory Training Section -->
    <div class="section">
      <h2>üß† Memory Training</h2>
      <p>Enhance memory using techniques like spaced repetition or active recall.</p>
      <select id="memoryTechnique">
        <option value="spaced_repetition" style="color: black;">Spaced Repetition</option>
        <option value="active_recall" style="color: black;">Active Recall</option>
        <option value="memory_palace" style="color: black;">Memory Palace</option>
        <option value="mnemonics" style="color: black;">Mnemonics</option>
      </select>
      <button class="btn" onclick="startMemoryTraining()">Start Training</button>
    </div>
  </div>

  
  <script>
    async function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      return parts.length === 2 ? parts.pop().split(';').shift() : null;
    }

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('pdfFile');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');

    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('border-blue-600', 'bg-white', 'bg-opacity-20');
    });
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('border-blue-600', 'bg-white', 'bg-opacity-20');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('border-blue-600', 'bg-white', 'bg-opacity-20');
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type === 'application/pdf') {
        fileInput.files = files;
        showFileInfo(files[0]);
      }
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        showFileInfo(e.target.files[0]);
      }
    });

    function showFileInfo(file) {
      fileName.textContent = file.name;
      fileInfo.classList.remove('hidden');
    }

    document.getElementById('pdfForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      const file = fileInput.files[0];
      if (!file) {
        alert('Please select a PDF file');
        return;
      }
      formData.append('pdf', file);
      document.getElementById('processing').classList.remove('hidden');
      document.querySelector('button[type="submit"]').disabled = true;
      try {
        const response = await fetch('/api/process-pdf', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${await getCookie('access_token')}` },
          body: formData
        });
        const result = await response.json();
        if (response.ok) {
          sessionStorage.setItem('processedContent', JSON.stringify(result));
          document.getElementById('result').classList.remove('hidden');
          document.getElementById('studyMaterial').value = result.summary;
        } else {
          throw new Error(result.detail || 'Processing failed');
        }
      } catch (error) {
        alert('Error processing PDF: ' + error.message);
      } finally {
        document.getElementById('processing').classList.add('hidden');
        document.querySelector('button[type="submit"]').disabled = false;
      }
    });

    document.getElementById('manualFlashcardForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const material = document.getElementById('studyMaterial').value;
      const topic = document.getElementById('flashcardTopic').value;
      const numCards = document.getElementById('numCards').value;
      if (!material.trim() || !topic.trim()) {
        alert('Please fill in all required fields');
        return;
      }
      const flashcardData = {
        name: `Manual Deck - ${topic}`,
        topic,
        cards: Array.from({ length: parseInt(numCards) }, (_, i) => ({
          question: `Question ${i + 1}`,
          answer: `Answer ${i + 1}`
        }))
      };
      try {
        const response = await fetch('/flashcards/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${await getCookie('access_token')}`
          },
          body: JSON.stringify(flashcardData)
        });
        if (response.ok) {
          window.location.href = '/flashcards';
        } else {
          throw new Error('Failed to generate flashcards');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    });

    async function generatePracticeTest() {
      const goal = document.getElementById('studyGoal').value;
      try {
        const response = await fetch('/practice-test/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${await getCookie('access_token')}`
          },
          body: JSON.stringify({ material_id: 1, duration: 30 })
        });
        if (response.ok) {
          window.location.href = '/practice-test';
        } else {
          throw new Error('Failed to generate practice test');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function getRecommendations() {
      try {
        const response = await fetch('/ai/recommendations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${await getCookie('access_token')}`
          }
        });
        const result = await response.json();
        if (response.ok) {
          const list = document.getElementById('recommendationsList');
          list.innerHTML = result.recommendations.map(item => `<li>${item}</li>`).join('');
          document.getElementById('recommendationsPopup').style.display = 'block';
        } else {
          throw new Error(result.detail || 'Failed to get recommendations');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function startMemoryTraining() {
      const technique = document.getElementById('memoryTechnique').value;
      window.location.href = `/memory_training?technique=${technique}`;
    }

    async function goToFlashcards() {
      const processedContent = sessionStorage.getItem('processedContent');
      let flashcardData;
      if (processedContent) {
        const content = JSON.parse(processedContent);
        flashcardData = {
          name: 'PDF Deck',
          topic: 'PDF Content',
          cards: Array.from({ length: 10 }, (_, i) => ({
            question: `Question ${i + 1}`,
            answer: `Answer ${i + 1}`
          }))
        };
      } else {
        const material = document.getElementById('studyMaterial').value;
        const topic = document.getElementById('flashcardTopic').value;
        const numCards = document.getElementById('numCards').value;
        if (!material || !topic) {
          alert('Please provide material and topic');
          return;
        }
        flashcardData = {
          name: `Manual Deck - ${topic}`,
          topic,
          cards: Array.from({ length: parseInt(numCards) }, (_, i) => ({
            question: `Question ${i + 1}`,
            answer: `Answer ${i + 1}`
          }))
        };
      }
      try {
        const response = await fetch('/flashcards/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${await getCookie('access_token')}`
          },
          body: JSON.stringify(flashcardData)
        });
        if (response.ok) {
          window.location.href = '/flashcards';
        } else {
          throw new Error('Failed to generate flashcards');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }
  </script>

</body>
</html>
